<!DOCTYPE html>
<html lang="en">
  <head>
    <style>
      canvas {
        background-color: #bad9fa;
      }
    </style>
    <meta charset="UTF-8" />
    <title>Document</title>
  </head>

  <body onload="startGame()">
    <!-- <audio src="something.mp3" id="audio"></audio> -->
    <!-- <audio src="gameover.mp3" id='audio1'></audio> -->

    <script type="text/javascript">
      var minHeight = 20;
      var maxHeight = 100;
      var minWidth = 10;
      var maxWidth = 20;
      var minGap = 200;
      var maxGap = 500;
      //add Array of obs
      var myObstacles = [];
      var colors = [
        "black",
        "red",
        "green",
        "yellow",
        "gray",
        "pink",
        "purple",
        "chocolate"
      ];
      var gap = randGap();

      //get audio
      //   var audio = document.getElementById("audio");
      //   var audio1 = document.getElementById("audio1")

      function startGame() {
        gamearea.start();
      }
      function everyinterval(n) {
        //if frame is a multiple of 'n' we send true
        if (gamearea.frame % n === 0) return true;
        return false;
      }

      //jumping is a changing of y-pos upward until reaching a given peak, then coming back down
      function jump() {
        player.speedY = -2;
        //play the audio in the 'jump' function
        // audio.play();
      }

      function randGap() {
        return Math.floor(minGap + Math.random() * (maxGap - minGap + 1));
      }

      var scoreText = {
        x: 900,
        y: 50,
        update: function(text) {
          gamearea.context.fillStyle = "gray";
          gamearea.context.font = "30px Consolas";
          gamearea.context.fillText(text, this.x, this.y);
        }
      };
      var player = {
        x: 20,
        y: 470,
        //make it jump
        speedY: 0,
        //draw the player
        update: function() {
          //dye the 'player' black otherwise it will be gray
          gamearea.context.fillStyle = "black";
          gamearea.context.fillRect(this.x, this.y, 30, 30);
        },
        newPos: function() {
          //it goes down if it 'y' reaches 280
          if (this.y < 280) {
            this.speedY = 2;
          }
          this.y = this.y + this.speedY;

          //it stops going down if it reaches 470
          if (this.speedY === 2 && this.y === 470) {
            this.speedY = 0;
          }
        },

        //crash happens when the coordinates of the player and the obs overlap

        crashWidth: function(obs) {
          if (
            this.x + 30 > obs.x &&
            this.x < obs.x + obs.width &&
            this.y + 30 > obs.y
          ) {
            return true;
          }
          return false;
        }
      };
      //drawing obstacles with random height, width, and coordinates
      //obs height and width is random value btw minHeight and maxHeight/ minWidth and maxWidth
      //gap btw 2 obs are random value btw minGap and maxGap
      function obstacle() {
        this.height = Math.floor(
          minHeight + Math.random() * (maxHeight - minHeight + 1)
        );
        this.width = Math.floor(
          minWidth + Math.random() * (maxWidth - minWidth + 1)
        );
        this.x = 1200;
        this.y = gamearea.canvas.height - this.height;
        //generate random index
        this.index = Math.floor(Math.random() * colors.length);
        //now we get the random color
        this.color = colors[this.index];
        //draw the obstacles
        this.draw = function() {
          gamearea.context.fillStyle = this.color;
          gamearea.context.fillRect(this.x, this.y, this.width, this.height);
        };
      }
      var gamearea = {
        canvas: document.createElement("canvas"),
        //start is intial actions
        start: function() {
          this.canvas.height = 500;
          this.canvas.width = 1200;
          document.body.insertBefore(this.canvas, document.body.childNodes[0]);
          this.context = this.canvas.getContext("2d");
          //frame counts how many times 'update gamearea' is ran
          this.frame = 0;
          //add score count
          this.score = 0;
          //give inital value of score
          scoreText.update("Score: 0");
          //execute "updateGameArea" every 5 ms
          this.interval = setInterval(this.updateGameArea, 5);
          //listener to handle the event of pressing a key in the keyboard
          window.addEventListener("keydown", jump);
        },
        updateGameArea: function() {
          //check for a crash
          for (let i = 0; i < myObstacles.length; i++) {
            if (player.crashWidth(myObstacles[i])) {
              gamearea.stop();
              //exit updateGameArea
              return;
            }
          }
          //clear game area before each new drawings
          gamearea.clear();
          //add more obs
          //After every 150times running 'updateGameArea'
          if (everyinterval(gap)) {
            myObstacles.push(new obstacle());
            //update gap after each bew added obs
            gap = randGap();
            //reset frame value
            gamearea.frame = 0;
          }
          for (let i = 0; i < myObstacles.length; i++) {
            //update the obs (x) every time
            myObstacles[i].x -= 1;
            myObstacles[i].draw();
          }
          player.newPos();
          player.update();
          gamearea.frame += 1;
          //update score
          gamearea.score += 0.01;
          scoreText.update("Score: " + Math.floor(gamearea.score));
        },
        //define everyinterval
        clear: function() {
          gamearea.context.clearRect(
            0,
            0,
            this.canvas.width,
            this.canvas.height
          );
        },
        stop: function() {
          clearInterval(this.interval);
          alert("Game Over");
          audio1.play();
        }
      };
    </script>
  </body>
</html>
